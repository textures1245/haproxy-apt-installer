global
    # Process and user settings
    daemon
    user haproxy
    group haproxy

    # Performance settings (equivalent to NGINX worker settings)
    maxconn 65535
    nbproc 1
    # nbthread auto  # Commented out for HAProxy 2.4 compatibility
    # Load Lua script for metrics aggregation (uses lua-cjson)
    # lua-load /etc/haproxy/metrics-aggregator.lua # Uncomment ถ้าจะเปิด User session monitoring

    # SSL/TLS settings
    ssl-default-bind-ciphers TLS_AES_256_GCM_SHA384:TLS_AES_128_GCM_SHA256:TLS_CHACHA20_POLY1305_SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256
    ssl-default-bind-ciphersuites TLS_AES_256_GCM_SHA384:TLS_AES_128_GCM_SHA256:TLS_CHACHA20_POLY1305_SHA256
    ssl-default-bind-options no-sslv3 no-tlsv10 no-tlsv11
    ssl-default-server-ciphers TLS_AES_256_GCM_SHA384:TLS_AES_128_GCM_SHA256:TLS_CHACHA20_POLY1305_SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256

    # Logging - Send to rsyslog on localhost
    log 127.0.0.1:514 local0 info
    

    # Stats socket for admin
    stats socket /var/run/haproxy/admin.sock mode 660 level admin
    stats timeout 30s

defaults
    mode http

    # Timeouts (equivalent to NGINX proxy settings)
    timeout connect 5s
    timeout client 30s
    timeout server 30s
    timeout http-request 30s
    timeout http-keep-alive 2s
    timeout queue 30s

    # Logging
    option httplog
    option dontlognull
    option logasap
    log global
    

    # Performance options
    option tcp-smart-accept
    option tcp-smart-connect
    option forwardfor header X-Forwarded-For
    option originalto header X-Original-To

    # Error pages
    errorfile 400 /etc/haproxy/errors/400.http
    errorfile 403 /etc/haproxy/errors/403.http
    errorfile 408 /etc/haproxy/errors/408.http
    errorfile 500 /etc/haproxy/errors/500.http
    errorfile 502 /etc/haproxy/errors/502.http
    errorfile 503 /etc/haproxy/errors/503.http
    errorfile 504 /etc/haproxy/errors/504.http

# Add peers section for UUID generation only (tables moved to backends for better memory management)

# peers sticktables # Uncomment ถ้าจะเปิด User session monitoring
#   peer {ชื่อ VM} 127.0.0.1:10000  # Uncomment ถ้าจะเปิด User session monitoring
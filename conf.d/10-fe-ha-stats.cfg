# Stats and Monitoring (equivalent to VTS)
frontend stats
    bind *:8404
    stats enable
    stats uri /stats
    stats refresh 5s
    stats admin if TRUE
    stats show-legends

    # Prometheus metrics endpoint
    http-request use-service prometheus-exporter if { path /metrics }

# Special frontend for Lua metrics API
# frontend metrics_lua_frontend # Uncomment ตรง block นี้ถ้าจะเปิด User session monitoring
#     bind *:8405
    
#     # Add CORS headers for browser access
#     http-response set-header "Access-Control-Allow-Origin" "*"
#     http-response set-header "Access-Control-Allow-Methods" "GET, OPTIONS"
#     http-response set-header "Access-Control-Allow-Headers" "Content-Type"

#     # Handle OPTIONS requests for CORS
#     http-request return status 200 if METH_OPTIONS
    
#     # Use Lua service for all requests to this frontend
#     http-request use-service lua.metrics_api
    